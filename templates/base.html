{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en" class="h-full" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true' }" :class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="JeyaRamaDesk — Enterprise Customer Support Platform">
    <title>{% block title %}JeyaRamaDesk{% endblock %}</title>

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe',
                            300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1',
                            600: '#4f46e5', 700: '#4338ca', 800: '#3730a3',
                            900: '#312e81', 950: '#1e1b4b',
                        },
                        sidebar: { DEFAULT: '#1e1b4b', hover: '#312e81' },
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                },
            },
        }
    </script>

    <!-- Alpine.js for interactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Heroicons (via inline SVG usage) -->

    <style>
        [x-cloak] { display: none !important; }
        body { font-family: 'Inter', system-ui, sans-serif; }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #c7d2fe; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #4338ca; }

        /* Smooth transitions */
        .sidebar-transition { transition: width 0.3s ease, transform 0.3s ease; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Toast animation */
        .toast-enter { animation: slideInRight 0.3s ease; }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>

<body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 antialiased">

    {% if user.is_authenticated %}
    <!-- ── Authenticated Layout ─────────────────────────────── -->
    <div x-data="{ sidebarOpen: true, mobileMenuOpen: false }" class="flex h-screen overflow-hidden">

        <!-- ── Sidebar ──────────────────────────────────────── -->
        {% include "includes/sidebar.html" %}

        <!-- ── Main Content Area ────────────────────────────── -->
        <div class="flex flex-col flex-1 overflow-hidden">

            <!-- ── Top Bar ──────────────────────────────────── -->
            {% include "includes/topbar.html" %}

            <!-- ── Page Content ─────────────────────────────── -->
            <main class="flex-1 overflow-y-auto p-4 md:p-6 lg:p-8">
                <!-- Flash Messages -->
                {% include "includes/messages.html" %}

                <!-- Page Content -->
                <div class="fade-in">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>

    {% else %}
    <!-- ── Public (Unauthenticated) Layout ──────────────────── -->
    <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-900 via-primary-800 to-primary-950 p-4">
        {% include "includes/messages.html" %}
        {% block public_content %}{% endblock %}
    </div>
    {% endif %}

    <!-- ── Global Scripts ─────────────────────────────────── -->
    <script>
        // CSRF token helper for AJAX
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let c of cookies) {
                    c = c.trim();
                    if (c.startsWith(name + '=')) {
                        cookieValue = decodeURIComponent(c.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

        // Auto-dismiss messages after 5 seconds
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.querySelectorAll('[data-auto-dismiss]').forEach(el => {
                    el.style.transition = 'opacity 0.5s';
                    el.style.opacity = '0';
                    setTimeout(() => el.remove(), 500);
                });
            }, 5000);
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
